alock: fix ARGB cursor alpha showing desktop due to grab ordering

When using an ARGB cursor image with transparency, some X servers and
drivers use a "save-under" optimization for the cursor. If the pointer
is grabbed before the lock background window has actually been mapped
and painted, the saved-under pixels may come from the pre-lock desktop.

This causes transparent regions of the cursor to reveal the real
desktop image, leaving a visible rectangular artifact around the
cursor.

Fix this by enforcing correct ordering in lockDisplay():
- Fully map and raise background windows first
- XSync to ensure the server has processed those requests
- Grab the pointer without a custom cursor
- XSync again to ensure the grab is active
- Install the real (possibly ARGB) cursor via XChangeActivePointerGrab

This ensures cursor alpha is always composited over the lock background
rather than stale desktop pixels.

No behavioral change for non-ARGB cursors.

diff --git a/src/main.c b/src/main.c
index 3cb09fd..77043bf 100644
--- a/src/main.c
+++ b/src/main.c
@@ -201,16 +201,36 @@ static int lockDisplay(Display *display, struct aModules *modules) {
         XSelectInput(display, RootWindow(display, i), StructureNotifyMask);
     }
 
+    /*
+     * Critical ordering:
+     * Make sure the server has actually processed map/raise/reparent before
+     * any pointer grab with an ARGB cursor. This avoids the "desktop box"
+     * effect where cursor alpha reveals stale saved-under pixels.
+     */
+    XSync(display, False);
+
     /* grab pointer and keyboard from the default screen */
     window = DefaultRootWindow(display);
-    cursor = modules->cursor->getcursor();
 
-    if (XGrabPointer(display, window, False, None, GrabModeAsync, GrabModeAsync, None,
-                cursor, CurrentTime) != GrabSuccess) {
+    /*
+     * Grab the pointer with no custom cursor first, then switch to the real
+     * cursor after the grab is active. This is more robust than grabbing
+     * directly with an ARGB cursor on some servers/drivers.
+     */
+    if (XGrabPointer(display, window, False, 0,
+                GrabModeAsync, GrabModeAsync, None,
+                None, CurrentTime) != GrabSuccess) {
         fprintf(stderr, "error: grab pointer failed\n");
         return -1;
     }
 
+    /* ensure grab is processed */
+    XSync(display, False);
+
+    /* now install the requested cursor (possibly ARGB) */
+    cursor = modules->cursor->getcursor();
+    XChangeActivePointerGrab(display, 0, cursor, CurrentTime);
+
     /* try to grab 2 times, another process (windowmanager) may have grabbed
      * the keyboard already */
     if (XGrabKeyboard(display, window, True, GrabModeAsync, GrabModeAsync,
